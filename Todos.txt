# AQUA NOVA PICO - Implementation Plan & Progress

## Overview
Building a submarine strategy game for Pico-8 from scratch.
Core Loop: Port â†’ Navigate â†’ Collect Samples â†’ Return â†’ Resupply

Full plan: /Users/nickwest/.claude/plans/precious-snuggling-rossum.md

---

## IMPLEMENTATION PROGRESS

### Phase 0: Foundation Skeleton âœ… COMPLETE
**Goal**: Basic Pico-8 structure with station switching
**Status**: DONE
**What was built**:
- Created _init(), _update(), _draw() functions
- Added gamestate variable to track current station
- Implemented station switching (left/right arrows)
- 5 station placeholders: Bridge, Helm, Science, Power, Status
**Testing**: Press left/right arrows to cycle through all 5 stations
**Tokens**: ~50

---

### Phase 1: Resource Display System âœ… COMPLETE
**Goal**: Show all game resources on Captain's Quarters screen
**Status**: DONE
**What was built**:
- Created resources table with 6 resource types
- money = 1000, food = 50, supplies = 20
- reactor = 100, o2_scrubbers = 100, reputation = 0
- Updated draw_status() with color-coded resource display
**Testing**: Navigate to Status station, see all resources
**Tokens**: ~80

---

### Phase 2: Time System & Resource Drain âœ… COMPLETE
**Goal**: Make time pass and watch food decrease
**Status**: DONE
**What was built**:
- Added game_time, day_length (1800 frames = 60 sec), current_day
- Time increments in _update(), new day every 60 seconds
- Food decreases by 1 each day
- Day counter displayed on quarters screen
- Game over message when food = 0
**Testing**: Watch days increment, food decrease to 0
**Tokens**: ~60


---

### Phase 3: Helm Controls âœ… COMPLETE
**Goal**: Manual controls for heading and speed
**Status**: DONE
**What was built**:
- Created sub table (x, y, heading, speed, depth)
- Implemented helm controls (left/right for heading, up/down for speed)
- Heading wraps at 0/360, speed clamped at 0-160
- Updated draw_helm() with heading, compass direction, speed, depth
- X button now switches stations (so arrows work for helm)
**Testing**: On helm, use arrows to adjust heading/speed
**Tokens**: ~100

---

### Phase 4: Submarine Movement âœ… COMPLETE
**Goal**: Submarine actually moves based on helm settings
**Status**: DONE
**What was built**:
- Decimal degree coordinate system (-180Â° to +180Â° lon, -90Â° to +90Â° lat)
- Full submarine physics with heading (0-360Â°), speed (0-160 kts), depth (0-1200m)
- Position updates based on heading/speed with proper trigonometry
- World wrapping at longitude boundaries, clamping at latitude poles
- Position display on helm and quarters screens
**Testing**: Set heading/speed, watch position change on helm/bridge
**Tokens**: ~80

---

### Phase 5: Bridge/Map Display âœ… COMPLETE
**Goal**: Tactical map showing submarine position
**Status**: DONE
**What was built**:
- Full 96x96 map display with corner mask and border masking
- 9-level zoom system (0.25x to 64x pixels per degree)
- Grid lines at 1-degree increments
- Rotated submarine sprite showing current heading
- Port marker at (100, 0)
- Sample site markers
- Real-time position tracking
- Info bars showing heading, speed, depth, time, coordinates
**Testing**: Watch submarine move on map as helm settings change
**Tokens**: ~250 (more complex than originally estimated)

---

### Phase 6: Waypoint System âœ… COMPLETE
**Goal**: Click to set waypoint, submarine auto-navigates
**Status**: DONE
**What was built**:
- Bridge map cursor with dpad control
- Multi-waypoint route planning (supports multiple waypoints)
- Automatic navigation to active waypoint
- Bearing and distance calculations for up to 3 waypoints
- Dashed route lines showing path
- Waypoint markers with numbers
- Auto-advance to next waypoint on arrival
- Gradual heading adjustment (5Â°/frame turn rate)
- Waypoint info display (bearing/distance for first 3 waypoints)
**Testing**: Place multiple waypoints, watch sub navigate through them
**Tokens**: ~200 (multi-waypoint more complex than planned)

---

### Phase 7: Sample Collection âœ… COMPLETE
**Goal**: Collect samples at waypoint locations
**Status**: DONE
**What was built**:
- 3 sample sites at various coordinates
- Automatic proximity detection (5-unit collection range)
- Auto-collection when in range
- Money reward (+$100 per sample)
- Sample counter on science station
- Collected/uncollected status display
**Testing**: Navigate to site, watch auto-collect
**Tokens**: ~100

---

### Phase 8A: Port Skeleton ðŸ”„ NEXT PRIORITY
**Goal**: Get basic port docking and resupply working
**Status**: NOT STARTED - **CRITICAL FOR GAMEPLAY LOOP**
**What to build**:
- Move port from (100, 0) to Woods Hole (-70.666Â°, 41.516Â°)
- Add `docked` boolean state
- Auto-dock when within 1/60 degree (1 minute) of port
- Helm station: "Leave Port" button when docked
- Quarters station: "Buy Food (10 units): $50" and "Undock" buttons
- Transaction logic: money â†’ food
**Testing**: Navigate to Woods Hole â†’ auto-dock â†’ buy food â†’ undock
**Tokens**: ~80
**Note**: This closes the survival loop - game becomes infinitely playable

---

### Phase 8B: Mission Data Structure â³ PENDING
**Goal**: Create mission/task system backend (no UI yet)
**What to build**:
- Mission table with tasks: `{type="reach_ao", lon1, lon2, lat1, lat2, complete}`
- Task types: reach_ao, depth, speed, collect
- Task auto-completion logic in `_update()`
- 1-2 hardcoded test missions
**Testing**: Watch task completion via data (no UI yet)
**Tokens**: ~120

---

### Phase 8C: Communications Station UI â³ PENDING
**Goal**: Display missions on communications station
**What to build**:
- Show mission header: "FROM: ADM. VASQUEZ"
- Display mission text (keep short, no scrolling)
- Task list with checkboxes: `[ ] Reach AO` / `[X] Dive to 100m`
- Mark mission as "read" when viewed
**Testing**: View comm station â†’ see mission â†’ see task checkboxes update
**Tokens**: ~100

---

### Phase 8D: Mission Flow & Alerts â³ PENDING
**Goal**: Add dynamic mission progression
**What to build**:
- "INCOMING MESSAGE" alert on non-comm stations
- Mission timer (separate from game_time, resets on undock)
- Reward notification when mission completes
- Queue next mission (hardcoded sequence)
**Testing**: Complete mission â†’ see reward â†’ get new mission â†’ see alert
**Tokens**: ~80

---

### Phase 9: Mission Expansion â³ PENDING (LATER)
**Goal**: Add advanced mission features
**What to build** (AFTER 8A-8D work):
- Secondary missions
- Mission expiration/failure with reputation penalty
- Text line-by-line animation
- Message scrolling (vertical/horizontal)
- Multiple message inbox
**Testing**: TBD
**Tokens**: ~100+

---

### Phase 10: Polish & Balance â³ PENDING
**Goal**: Make the loop fun and well-tuned
**What to build**:
- Balance resource consumption rates
- Add feedback (messages, pauses)
- Title screen
- Controls help screen
- Optional sound effects
**Testing**: Play complete loop multiple times
**Tokens**: ~100

---

## TOKEN BUDGET (ESTIMATED - needs verification in PICO-8)

Phases 0-3: ~290 tokens (COMPLETE)
Phases 4-7: ~630 tokens estimated (COMPLETE - more complex than planned)
Phase 8A (Port skeleton): ~80 tokens
Phase 8B (Mission data): ~120 tokens
Phase 8C (Comm UI): ~100 tokens
Phase 8D (Mission flow): ~80 tokens
Phase 9 (Future expansion): ~100+ tokens
Phase 10 (Polish): ~100 tokens
TOTAL ESTIMATED: ~1500 tokens

âš ï¸ **ACTION NEEDED**: Load cart in PICO-8 and check actual token count (Ctrl+P)
   User reports: 50% char capacity, 61% compressed capacity used

ðŸ’¡ **CAPACITY CHECK**: With ~39% remaining and ~580 tokens needed for phases 8A-10,
   should have comfortable margin for mission system + future features

---

## PICO-8 KEY CONCEPTS

**The Three Sacred Functions**:
- _init() - Runs once at start
- _update() - Runs 30 times per second (logic)
- _draw() - Runs 30 times per second (display)

**Unified Control Scheme** (IMPORTANT!):
- Up/Down Arrows: Cycle through fields (including STATION field)
- Left/Right Arrows: Adjust value of highlighted field
- Visual highlight shows selected field: >field: value<
- Every station has a STATION field (left/right cycles stations)
- X (âŽ) button: Accept/Confirm (reserved for future menus)
- O (ðŸ…¾ï¸) button: Cancel/Back (reserved for future menus)

**Button Mapping**:
- 0=left, 1=right, 2=up, 3=down, 4=O, 5=X
- btnp() = pressed this frame
- btn() = held down

**Angles**:
- Pico-8 uses 0.0-1.0 for full circle (not 0-360)
- Convert: pico_angle = degrees / 360

**Colors**:
- 0=black, 6=light_gray, 7=white
- 8=red, 10=yellow, 11=green, 12=blue

---

## CURRENT STATUS

âœ… Phase 0 complete - Multi-station skeleton working
âœ… Phase 1 complete - Resource display system
âœ… Phase 2 complete - Time system & resource drain
âœ… Phase 3 complete - Helm controls
âœ… Phase 4 complete - Submarine movement (decimal degrees, wrapping)
âœ… Phase 5 complete - Bridge/Map display (zoom, grid, sprites)
âœ… Phase 6 complete - Waypoint navigation (multi-waypoint routing)
âœ… Phase 7 complete - Sample collection (auto-collect in range)
ðŸ”„ Next: Phase 8A - Port Skeleton **â† CRITICAL - CLOSES SURVIVAL LOOP**
ðŸ“Š Progress: 7/13 phases complete (54%)

âš ï¸ **ANTI-PERFECTIONISM STRATEGY**:
   - Phase 8 split into 4 minimal increments (8A-8D)
   - Each sub-phase is bare minimum to work
   - Get ALL working before adding polish
   - Defer advanced features (scrolling, animation, secondary missions) until AFTER basic loop works

ðŸ“‹ **MISSION SYSTEM VISION** (from /Users/nickwest/.claude/plans/humble-stargazing-karp.md):
   - Admiral Elena Vasquez (O.E.R.A.) sends missions via Communications
   - Multi-task missions: reach AO â†’ dive to depth â†’ collect samples â†’ return to port
   - Port: Woods Hole Oceanographic Institute (-70Â°40'W, 41Â°31'N)
   - Mission timer resets on undock, time continues while docked

---

## NOTES

- Keep testing after each phase
- Run cart in Pico-8 with: load aquanova.p8 then run
- Check token count with Ctrl+P in editor
- Commit to git after each working phase
- Update README as features complete
